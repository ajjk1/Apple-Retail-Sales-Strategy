name: Sync to Hugging Face hub # 워크플로우 이름
on:
  push:
    branches: [main] # main 브랜치에 push될 때 실행
  workflow_dispatch: # 수동 실행 버튼 추가

jobs:
  build:
    runs-on: ubuntu-latest # 실행 환경
    steps:
      - name: Checkout code
        uses: actions/checkout@v4 # 코드 가져오기
        with:
          fetch-depth: 0
          lfs: true # 대용량 파일 처리를 위해 true 설정

      - name: Push to hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }} # 깃허브 비밀값에서 토큰 로드
        run: |
          # 1. 10MB가 넘는 폴더를 전송 대상에서 강제로 제외하는 독립된 if문 로직
          if [ -d "model-server/00.old" ]; then
            rm -rf model-server/00.old
            echo "대용량 백업 폴더를 전송 목록에서 삭제했습니다."
          fi
          
          # 2. 허깅페이스 Space로 푸시 (대상: apple-retail-study/Apple-Retail-Sales-Strategy)
          # HF_TOKEN 소유 계정이 해당 Space 쓰기 권한이 있어야 함
          git push --force https://ajjk1:$HF_TOKEN@huggingface.co/spaces/apple-retail-study/Apple-Retail-Sales-Strategy main
